!function(a,b){"function"==typeof define&&define.amd?define(["jquery","angular"],b):"object"==typeof exports&&"object"==typeof module?module.exports=b(a.$,a.angular):(a.ngRNDR=b(a.$,a.angular),a.ngRNDR.plugins={})}(this,function(){var a,b,c;return function(d){function e(a,b){return v.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=b&&b.split("/"),p=t.map,q=p&&p["*"]||{};if(a){for(a=a.split("/"),g=a.length-1,t.nodeIdCompat&&x.test(a[g])&&(a[g]=a[g].replace(x,"")),"."===a[0].charAt(0)&&o&&(n=o.slice(0,o.length-1),a=n.concat(a)),k=0;k<a.length;k++)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(0===k||1===k&&".."===a[2]||".."===a[k-1])continue;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}if((o||q)&&p){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),o)for(l=o.length;l>0;l-=1)if(e=p[o.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&q&&q[d]&&(i=q[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(a,b){return function(){var c=w.call(arguments,0);return"string"!=typeof c[0]&&1===c.length&&c.push(null),o.apply(d,c.concat([a,b]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){r[a]=b}}function j(a){if(e(s,a)){var b=s[a];delete s[a],u[a]=!0,n.apply(d,b)}if(!e(r,a)&&!e(u,a))throw new Error("No "+a);return r[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return a?k(a):[]}function m(a){return function(){return t&&t.config&&t.config[a]||{}}}var n,o,p,q,r={},s={},t={},u={},v=Object.prototype.hasOwnProperty,w=[].slice,x=/\.js$/;p=function(a,b){var c,d=k(a),e=d[0],g=b[1];return a=d[1],e&&(e=f(e,g),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(g)):f(a,g):(a=f(a,g),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},q={require:function(a){return g(a)},exports:function(a){var b=r[a];return"undefined"!=typeof b?b:r[a]={}},module:function(a){return{id:a,uri:"",exports:r[a],config:m(a)}}},n=function(a,b,c,f){var h,k,m,n,o,t,v,w=[],x=typeof c;if(f=f||a,t=l(f),"undefined"===x||"function"===x){for(b=!b.length&&c.length?["require","exports","module"]:b,o=0;o<b.length;o+=1)if(n=p(b[o],t),k=n.f,"require"===k)w[o]=q.require(a);else if("exports"===k)w[o]=q.exports(a),v=!0;else if("module"===k)h=w[o]=q.module(a);else if(e(r,k)||e(s,k)||e(u,k))w[o]=j(k);else{if(!n.p)throw new Error(a+" missing "+k);n.p.load(n.n,g(f,!0),i(k),{}),w[o]=r[k]}m=c?c.apply(r[a],w):void 0,a&&(h&&h.exports!==d&&h.exports!==r[a]?r[a]=h.exports:m===d&&v||(r[a]=m))}else a&&(r[a]=c)},a=b=o=function(a,b,c,e,f){if("string"==typeof a)return q[a]?q[a](b):j(p(a,l(b)).f);if(!a.splice){if(t=a,t.deps&&o(t.deps,t.callback),!b)return;b.splice?(a=b,b=c,c=null):a=d}return b=b||function(){},"function"==typeof c&&(c=e,e=f),e?n(d,a,b,c):setTimeout(function(){n(d,a,b,c)},4),o},o.config=function(a){return o(a)},a._defined=r,c=function(a,b,c){if("string"!=typeof a)throw new Error("See almond README: incorrect module build, no module name");b.splice||(c=b,b=[]),e(r,a)||e(s,a)||(s[a]=[a,b,c])},c.amd={jQuery:!0}}(),c("../node_modules/almond/almond",function(){}),c("directives/rndr",[],function(){"use strict";return function(){return{restrict:"E",scope:{engine:"=",input:"="},link:{pre:function(a,b,c){a.engine.element=$(b),a.engine.draw(a.input)}}}}}),c("services/aggregators",[],function(){"use strict";return function(a,b){function c(){this.add("Count",a.count(b.usFmtInt())),this.add("Count Unique Values",a.countUnique(b.usFmtInt())),this.add("List Unique Values",a.listUnique(", ")),this.add("Sum",a.sum(b.usFmt())),this.add("Integer Sum",a.sum(b.usFmtInt())),this.add("Average",a.average(b.usFmt())),this.add("Minimum",a.min(b.usFmt())),this.add("Maximum",a.max(b.usFmt())),this.add("Sum over Sum",a.sumOverSum(b.usFmt())),this.add("80% Upper Bound",a.sumOverSumBound80(!0,b.usFmt())),this.add("80% Lower Bound",a.sumOverSumBound80(!1,b.usFmt())),this.add("Sum as Fraction of Total",a.fractionOf(a.sum(),"total",b.usFmtPct())),this.add("Sum as Fraction of Rows",a.fractionOf(a.sum(),"row",b.usFmtPct())),this.add("Sum as Fraction of Columns",a.fractionOf(a.sum(),"col",b.usFmtPct())),this.add("Count as Fraction of Total",a.fractionOf(a.count(),"total",b.usFmtPct())),this.add("Count as Fraction of Rows",a.fractionOf(a.count(),"row",b.usFmtPct())),this.add("Count as Fraction of Columns",a.fractionOf(a.count(),"col",b.usFmtPct()))}return c.prototype={constructor:c,add:function(a,b){this[a]={aggregate:b}},list:function(){return Object.keys(this)}},new c}}),c("services/aggregatorTemplates",[],function(){"use strict";return function(a){function b(){}return b.prototype={constructor:b,count:function(b){return null==b&&(b=a.usFmtInt),function(){return function(a,c,d){return{count:0,push:function(){return this.count++},value:function(){return this.count},format:b}}}},countUnique:function(b){return null==b&&(b=a.usFmtInt),function(a){var c;return c=a[0],function(a,d,e){return{uniq:[],push:function(a){var b;if(b=a[c],this.uniq.indexOf(b)<0)return this.uniq.push(a[c])},value:function(){return this.uniq.length},format:b,numInputs:null!=c?0:1}}}},listUnique:function(a){return function(b){var c;return c=b[0],function(b,d,e){return{uniq:[],push:function(a){var b;if(b=a[c],this.uniq.indexOf(b)<0)return this.uniq.push(a[c])},value:function(){return this.uniq.join(a)},format:function(a){return a},numInputs:null!=c?0:1}}}},sum:function(b){return null==b&&(b=a.usFmt),function(a){var c;return c=a[0],function(a,d,e){return{sum:0,push:function(a){if(!isNaN(parseFloat(a[c])))return this.sum+=parseFloat(a[c])},value:function(){return this.sum},format:b,numInputs:null!=c?0:1}}}},min:function(b){return null==b&&(b=a.usFmt),function(a){var c;return c=a[0],function(a,d,e){return{val:null,push:function(a){var b,d;if(d=parseFloat(a[c]),!isNaN(d))return this.val=Math.min(d,null!=(b=this.val)?b:d)},value:function(){return this.val},format:b,numInputs:null!=c?0:1}}}},max:function(b){return null==b&&(b=a.usFmt),function(a){var c;return c=a[0],function(a,d,e){return{val:null,push:function(a){var b,d;if(d=parseFloat(a[c]),!isNaN(d))return this.val=Math.max(d,null!=(b=this.val)?b:d)},value:function(){return this.val},format:b,numInputs:null!=c?0:1}}}},average:function(b){return null==b&&(b=a.usFmt),function(a){var c;return c=a[0],function(a,d,e){return{sum:0,len:0,push:function(a){if(!isNaN(parseFloat(a[c])))return this.sum+=parseFloat(a[c]),this.len++},value:function(){return this.sum/this.len},format:b,numInputs:null!=c?0:1}}}},sumOverSum:function(b){return null==b&&(b=a.usFmt),function(a){var c,d;return d=a[0],c=a[1],function(a,e,f){return{sumNum:0,sumDenom:0,push:function(a){if(isNaN(parseFloat(a[d]))||(this.sumNum+=parseFloat(a[d])),!isNaN(parseFloat(a[c])))return this.sumDenom+=parseFloat(a[c])},value:function(){return this.sumNum/this.sumDenom},format:b,numInputs:null!=d&&null!=c?0:2}}}},sumOverSumBound80:function(b,c){return null==b&&(b=!0),null==c&&(c=a.usFmt),function(a){var d,e;return e=a[0],d=a[1],function(a,f,g){return{sumNum:0,sumDenom:0,push:function(a){if(isNaN(parseFloat(a[e]))||(this.sumNum+=parseFloat(a[e])),!isNaN(parseFloat(a[d])))return this.sumDenom+=parseFloat(a[d])},value:function(){var a;return a=b?1:-1,(.821187207574908/this.sumDenom+this.sumNum/this.sumDenom+1.2815515655446004*a*Math.sqrt(.410593603787454/(this.sumDenom*this.sumDenom)+this.sumNum*(1-this.sumNum/this.sumDenom)/(this.sumDenom*this.sumDenom)))/(1+1.642374415149816/this.sumDenom)},format:c,numInputs:null!=e&&null!=d?0:2}}}},fractionOf:function(b,c,d){return null==c&&(c="total"),null==d&&(d=a.usFmtPct),function(){var a;return a=1<=arguments.length?slice.call(arguments,0):[],function(e,f,g){return{selector:{total:[[],[]],row:[f,[]],col:[[],g]}[c],inner:b.apply(null,a)(e,f,g),push:function(a){return this.inner.push(a)},format:d,value:function(){return this.inner.value()/e.getAggregator.apply(e,this.selector).inner.value()},numInputs:b.apply(null,a)().numInputs}}}}},new b}}),c("services/dataViews",[],function(){"use strict";return function(){function a(){}return a.prototype={constructor:a,add:function(a,b,c){this[a]={view:b,meta:c}},list:function(){return Object.keys(this)}},new a}}),c("services/renderers",[],function(){"use strict";return function(){function a(){}return a.prototype={constructor:a,add:function(a,b,c){this[a]={render:b,opts:c}},list:function(){return Object.keys(this)}},new a}}),c("services/RenderingEngine",[],function(){"use strict";return function(a,b,c,d,f,g,h,i){function j(a,e,f,g,h){this.dataSourceConfigId=a,void 0===e||""===e?this.id=b.generateUUID():this.id=e,void 0===f||""===f?this.title="Untitiled":this.title=f,void 0===h||""===h?this.rendererName="DT - Table":this.rendererName=h,this.dataView={meta:d[c[this.rendererName].opts.dataViewName].meta()}}return j.prototype={constructor:j,initializeAggregator:function(){void 0===this.aggregator&&(this.aggregator={name:"Count",aggregate:function(){},numInputsToProcess:[],aggInputAttributeName:[]});var b=a[this.aggregator.name].aggregate([])([]).numInputs;void 0===b?(this.aggregator.numInputsToProcess=new Array,this.aggregator.aggInputAttributeName=new Array):(this.aggregator.numInputsToProcess=new Array(b),this.aggregator.aggInputAttributeName.length!==b&&(this.aggregator.aggInputAttributeName=new Array(b))),this.aggregator.aggregate=a[this.aggregator.name].aggregate([this.aggregator.aggInputAttributeName])},draw:function(a,h){var j=this;void 0!==h&&""!==h&&(j.rendererName=h);var k=f.defer();return i.$emit("RenderingEngine:draw:begin"),g(function(a){var f;try{j.initializeAggregator();var g={id:j.id,title:j.title,aggregator:j.aggregator,dataUtils:b,meta:j.dataView.meta};j.dataView=new d[c[j.rendererName].opts.dataViewName].view(a,g);try{c[j.rendererName].opts.height=j.element.parent().parent().innerHeight(),c[j.rendererName].opts.width=j.element.parent().parent().innerWidth(),f=c[j.rendererName].render(j.dataView,c[j.rendererName].opts)}catch(a){e=a,"undefined"!=typeof console&&null!==console&&console.error(e.stack),f=$("<span>").html(g.localeStrings.renderError)}}catch(a){e=a,"undefined"!=typeof console&&null!==console&&console.error(e.stack),f=$("<span>").html(g.localeStrings.computeError)}j.element.empty(),j.element.append(f.html),i.$emit("RenderingEngine:draw:complete"),f.postRenderFunction&&f.postRenderFunction(f.html,f.postRenderOpts),k.resolve()},1500,!0,a),k.promise}},j}}),c("services/RenderingEngines",[],function(){"use strict";return function(a,b,c,d){function e(){this.init()}return e.prototype={constructor:e,init:function(){var a=this;a.map={},a.activeRenderingEngine=void 0},create:function(b,c,d,e){var f=this,g=new a(b,c,d,e);return f.add(g),void 0!==f.activeRenderingEngine&&(f.map[f.activeRenderingEngine].active=!1),f.activeRenderingEngine=g.id,g},size:function(){return Object.keys(this.map).length},add:function(a){var b=this;b.map[a.id]=a},delete:function(a){var b=this;delete b.map[a]}},e}}),c("services/dataUtils",[],function(){"use strict";return function(){function a(){}return a.prototype={constructor:a,hasProp:{}.hasOwnProperty,indexOf:[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},convertToArray:function(a){var b,c=this;return b=[],c.forEachRecord(a,{},function(a){return b.push(a)}),b},bind:function(a,b){return function(){return a.apply(b,arguments)}},forEachRecord:function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=this;if(d=$.isEmptyObject(b)?c:function(a){var d,e,f;for(d in b)f=b[d],a[d]=null!=(e=f(a))?e:a[d];return c(a)},$.isFunction(a))return a(d);if($.isArray(a)){if($.isArray(a[0])){m=[];for(f in a)if(p.hasProp.call(a,f)&&(e=a[f],f>0)){k={},l=a[0];for(g in l)p.hasProp.call(l,g)&&(h=l[g],k[h]=e[g]);m.push(d(k))}return m}for(n=[],i=0,j=a.length;i<j;i++)k=a[i],n.push(d(k));return n}if(a instanceof jQuery)return o=[],$("thead > tr > th",a).each(function(a){return o.push($(this).text())}),$("tbody > tr",a).each(function(a){return k={},$("td",this).each(function(a){return k[o[a]]=$(this).html()}),d(k)});throw new Error("unknown input format")},addSeparators:function(a,b,c){var d,e,f,g;for(a+="",e=a.split("."),f=e[0],g=e.length>1?c+e[1]:"",d=/(\d+)(\d{3})/;d.test(f);)f=f.replace(d,"$1"+b+"$2");return f+g},numberFormat:function(a){var b,c=this;return b={digitsAfterDecimal:2,scaler:1,thousandsSep:",",decimalSep:".",prefix:"",suffix:"",showZero:!1},a=$.extend(b,a),function(b){var d;return isNaN(b)||!isFinite(b)?"":0!==b||a.showZero?(d=c.addSeparators((a.scaler*b).toFixed(a.digitsAfterDecimal),a.thousandsSep,a.decimalSep),""+a.prefix+d+a.suffix):""}},sortAs:function(a){var b,c,d,e=this;c={};for(b in a)d=a[b],c[d]=b;return function(a,b){return null!=c[a]&&null!=c[b]?c[a]-c[b]:null!=c[a]?-1:null!=c[b]?1:e.naturalSort(a,b)}},naturalSort:function(a,b){var c,d,e,f,g,h,i;if(h=/(\d+)|(\D+)/g,g=/\d/,i=/^0/,"number"==typeof a||"number"==typeof b)return isNaN(a)?1:isNaN(b)?-1:a-b;if(c=String(a).toLowerCase(),e=String(b).toLowerCase(),c===e)return 0;if(!g.test(c)||!g.test(e))return c>e?1:-1;for(c=c.match(h),e=e.match(h);c.length&&e.length;)if(d=c.shift(),f=e.shift(),d!==f)return g.test(d)&&g.test(f)?d.replace(i,".0")-f.replace(i,".0"):d>f?1:-1;return c.length-e.length},getSort:function(a,b){var c,d=this;return c=a(b),$.isFunction(c)?c:d.naturalSort},usFmt:function(){var a=this;return a.numberFormat()},usFmtInt:function(){var a=this;return a.numberFormat({digitsAfterDecimal:0})},usFmtPct:function(){var a=this;return a.numberFormat({digitsAfterDecimal:1,scaler:100,suffix:"%"})}},new a}}),c("services/DataSourceConfiguration",[],function(){"use strict";return function(a){function b(b,c){this.id=a.generateUUID(),this.flattenDataFunctionString="return data;",this.httpConfig=c,this.name=b}return b.prototype={constructor:b},b}}),c("services/dataSourceConfigurations",[],function(){"use strict";return function(a){function b(){this.init()}return b.prototype={constructor:b,init:function(){var a=this;a.map={},a.activeDataSourceConfiguration=void 0},create:function(b,c){var d=this,e=new a(b,c);return d.add(e),d.activeDataSourceConfiguration=e.id,e.id},size:function(){return Object.keys(this.map).length},add:function(a){var b=this;b.map[a.id]=a},delete:function(a){var b=this;delete b.map[a]}},new b}}),c("services/DataSource",[],function(){"use strict";return function(a,b,c,d){function e(a,b){this.dataSourceConfigId=a,this.data,this.name=b,this.formattedData}return e.prototype={constructor:e,refresh:function(){var a=[this.acquire(this)];b.all(a).then(function(){this.format(this)})},acquire:function(){c.$emit("dataSource:acquire:begin");var e=this,f=b.defer();return d(angular.fromJson(a.map[this.dataSourceConfigId].httpConfig)).then(function(a){"string"!=typeof a.data?e.data=JSON.stringify(a.data):e.data=a.data,f.resolve(),c.$emit("dataSource:acquire:success")},function(a){f.reject(),c.$emit("dataSource:acquire:error")}),f.promise},format:function(){var b=new Function("data",a.map[this.dataSourceConfigId].flattenDataFunctionString);try{this.formattedData=angular.toJson(b(angular.fromJson(this.data)))}catch(a){try{this.formattedData=b(this.data)}catch(a){"undefined"!=typeof console&&null!==console&&console.error(a.stack)}}try{this.formattedData=angular.fromJson(this.formattedData)}catch(a){try{this.formattedData=$.csv.toArrays(this.formattedData)}catch(a){"undefined"!=typeof console&&null!==console&&console.error(a.stack)}}}},e}}),c("services/dataSources",[],function(){"use strict";return function(a){function b(){this.init()}return b.prototype={constructor:b,init:function(){var a=this;a.map={}},create:function(b,c){var d=this;if(void 0!==b){var e=new a(b,c);return d.add(e),e}},add:function(a){var b=this;b.map[a.dataSourceConfigId]=a},delete:function(a){var b=this;delete b.map[a]},refresh:function(){angular.forEach(this.map,function(a){a.refresh()})}},new b}}),c("ng-rndr",["directives/rndr","services/aggregators","services/aggregatorTemplates","services/dataViews","services/renderers","services/RenderingEngine","services/RenderingEngines","services/dataUtils","services/DataSourceConfiguration","services/dataSourceConfigurations","services/DataSource","services/dataSources"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=angular.module("ngRndr",[]);a.$inject=[],i.$inject=["ngRndr.dataUtils"],j.$inject=["ngRndr.DataSourceConfiguration"],k.$inject=["ngRndr.dataSourceConfigurations","$q","$rootScope","$http"],l.$inject=["ngRndr.DataSource"],b.$inject=["ngRndr.aggregatorTemplates","ngRndr.dataUtils"],c.$inject=["ngRndr.dataUtils"],d.$inject=[],e.$inject=[],f.$inject=["ngRndr.aggregators","ngRndr.dataUtils","ngRndr.renderers","ngRndr.dataViews","$q","$timeout","$window","$rootScope"],g.$inject=["ngRndr.RenderingEngine","ngRndr.dataSourceConfigurations","ngRndr.dataSources","$http"],h.$inject=[],m.directive("rndr",a),m.service("ngRndr.DataSourceConfiguration",i),m.service("ngRndr.dataSourceConfigurations",j),m.service("ngRndr.DataSource",k),m.service("ngRndr.dataSources",l),m.service("ngRndr.aggregators",b),m.service("ngRndr.aggregatorTemplates",c),m.service("ngRndr.dataViews",d),m.service("ngRndr.renderers",e),m.service("ngRndr.RenderingEngine",f),m.service("ngRndr.RenderingEngines",g),m.service("ngRndr.dataUtils",h)}),b("ng-rndr")});
//# sourceMappingURL=ng-rndr.min.js.map